---
import type { CollectionEntry } from "astro:content";
import { getRelatedPosts } from "../lib/related-posts";
import Prose from "./prose.astro";

interface Props {
  entry: CollectionEntry<"posts"> | CollectionEntry<"pages">;
  preview?: boolean;
}

const { entry } = Astro.props;

const { Content } = await entry.render();

const relatedPosts = await getRelatedPosts(entry.slug);
---

{
  entry.collection === "posts" && (
    <>
      <h1 class="max-sm:mt-4 text-gray-900 text-3xl sm:text-4xl font-extrabold">
        {entry.data.title}
      </h1>

      {entry.data.date && (
        <time class="block mt-2 text-sm font-semibold text-gray-400">
          {entry.data.date.toLocaleString("en-US", {
            timeZone: "UTC",
            month: "long",
            day: "numeric",
            year: "numeric",
          })}
        </time>
      )}
    </>
  )
}

<div class:list={[entry.collection === "posts" ? "mt-7" : "mt-2"]}>
  <Prose>
    <Content />
  </Prose>
</div>

{
  entry.collection === "posts" && relatedPosts.length > 0 && (
    <section class="relative mt-20">
      <p class="absolute -top-5 -left-2 -rotate-3 bg-white text-gray-600 italic text-sm font-medium px-2 py-0.5 border border-gray-200 max-w-max shadow-xs">
        Related Posts
      </p>
      <div class="flex max-sm:flex-wrap gap-x-1.5 gap-y-1.5">
        {relatedPosts.map((post) => (
          <a
            href={`/${post.slug}`}
            class="flex flex-col bg-white shadow-sm px-2 py-1.5 border border-gray-200"
          >
            <p class="text-lg font-serif underline decoration-gray-200 leading-[1.3]">
              {post.data.title}
            </p>
            <p class="mt-auto pt-0.5 text-sm font-medium text-gray-400 whitespace-nowrap">
              {post.data.date.toLocaleString("en-US", {
                timeZone: "UTC",
                month: "long",
                day: "numeric",
                year: "numeric",
              })}
            </p>
          </a>
        ))}
      </div>
    </section>
  )
}
