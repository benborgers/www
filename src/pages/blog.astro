---
import Layout from "../layouts/layout.astro";
import { getPosts } from "../lib/posts";

const posts = await getPosts({ includeUnlisted: false });

const postsByMonth = Object.groupBy(posts, (post) => {
  const date = post.data.date;
  if (!date) throw new Error("Post has no date");
  return date.toLocaleString("en-US", {
    timeZone: "UTC",
    month: "long",
    year: "numeric",
  });
});
---

<Layout title="Ben Borgersâ€™ Blog">
  <div>
    {
      Object.entries(postsByMonth).map(([heading, posts]) => (
        <>
          <p class="mt-6 first-of-type:mt-0 text-gray-400 font-medium">
            {heading}
          </p>

          {posts!.map((post) => (
            <p class="mt-1">
              <a
                href={`/${post.slug}`}
                class="text-gray-900 font-medium text-xl underline decoration-1 decoration-gray-300 underline-offset-[1.5px]"
              >
                {post.data.title}
              </a>
            </p>
          ))}
        </>
      ))
    }
  </div>
</Layout>
