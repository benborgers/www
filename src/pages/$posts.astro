---
import matter from 'gray-matter'
// TODO: remove Prism component, this is a hack to get Snowpack to work.
import { Markdown, Prism } from 'astro/components'
import Post from '../components/Post'
import loadObsidianPosts from '../lib/loadObsidianPosts'

export async function createCollection() {
    const obsidianPosts = await loadObsidianPosts()

    return {
        route: '/posts/:slug',
        paths: () => obsidianPosts.map(post => ({ params: post })),
        props: ({ params }) => {
            return {
                post: obsidianPosts.find(post => post.slug === params.slug)
            }
        }
    }
}

const { post } = Astro.props
---

<Prism code={`const foo = 'bar' `} />

<Post
    title={post.title}
    date={post.date}
>
    <div>
        <Markdown content={matter(post.body).content} />
    </div>
</Post>
